-- CUSTOM UI LIBRARY - WORKSPACE VERSION (100% UNDETECTABLE)
-- Keine ScreenGui in CoreGui/PlayerGui - Alles im Workspace!

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

local Library = {
	Flags = {},
	Connections = {}
}

-- Create invisible anchor part in workspace
local AnchorPart = Instance.new("Part")
AnchorPart.Name = HttpService:GenerateGUID(false)
AnchorPart.Size = Vector3.new(1, 1, 1)
AnchorPart.Transparency = 1
AnchorPart.CanCollide = false
AnchorPart.Anchored = true
AnchorPart.CFrame = CFrame.new(0, 99999, 0)
AnchorPart.Parent = Workspace

-- Main BillboardGui
local MainGui = Instance.new("BillboardGui")
MainGui.Name = HttpService:GenerateGUID(false)
MainGui.Size = UDim2.new(0, 800, 0, 600)
MainGui.StudsOffset = Vector3.new(0, 0, 0)
MainGui.AlwaysOnTop = true
MainGui.ClipsDescendants = false
MainGui.ResetOnSpawn = false
MainGui.Adornee = AnchorPart
MainGui.Parent = AnchorPart

-- Keep part in front of camera
task.spawn(function()
	while AnchorPart.Parent do
		local cf = Camera.CFrame * CFrame.new(0, 0, -5)
		AnchorPart.CFrame = cf
		task.wait()
	end
end)

-- Helper Functions
local function Create(class, properties)
	local object = Instance.new(class)
	for prop, value in pairs(properties or {}) do
		object[prop] = value
	end
	return object
end

local function AddCorner(parent, radius)
	return Create("UICorner", {
		CornerRadius = UDim.new(0, radius or 10),
		Parent = parent
	})
end

local function AddStroke(parent, color, thickness)
	return Create("UIStroke", {
		Color = color or Color3.fromRGB(60, 60, 60),
		Thickness = thickness or 1,
		Parent = parent
	})
end

local function AddPadding(parent, all)
	return Create("UIPadding", {
		PaddingTop = UDim.new(0, all or 10),
		PaddingBottom = UDim.new(0, all or 10),
		PaddingLeft = UDim.new(0, all or 10),
		PaddingRight = UDim.new(0, all or 10),
		Parent = parent
	})
end

local function AddListLayout(parent, padding)
	return Create("UIListLayout", {
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, padding or 8),
		Parent = parent
	})
end

-- Dragging System for Workspace GUI
local function MakeDraggable(frame, dragHandle)
	local dragging = false
	local dragInput, mousePos, framePos
	
	dragHandle.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			mousePos = input.Position
			framePos = frame.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	
	dragHandle.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - mousePos
			frame.Position = UDim2.new(
				framePos.X.Scale,
				framePos.X.Offset + delta.X,
				framePos.Y.Scale,
				framePos.Y.Offset + delta.Y
			)
		end
	end)
end

function Library:CreateWindow(config)
	config = config or {}
	config.Name = config.Name or "UI Library"
	config.IntroEnabled = config.IntroEnabled ~= false
	
	local Window = {
		Tabs = {},
		CurrentTab = nil
	}
	
	-- Main Container
	local MainFrame = Create("Frame", {
		Name = "Main",
		Size = UDim2.new(0, 615, 0, 400),
		Position = UDim2.new(0.5, -307, 0.5, -200),
		BackgroundColor3 = Color3.fromRGB(25, 25, 25),
		BorderSizePixel = 0,
		ClipsDescendants = true,
		Parent = MainGui
	})
	AddCorner(MainFrame, 10)
	AddStroke(MainFrame, Color3.fromRGB(60, 60, 60), 2)
	
	-- Top Bar
	local TopBar = Create("Frame", {
		Name = "TopBar",
		Size = UDim2.new(1, 0, 0, 45),
		BackgroundColor3 = Color3.fromRGB(20, 20, 20),
		BorderSizePixel = 0,
		Parent = MainFrame
	})
	AddCorner(TopBar, 10)
	
	local TopBarBottom = Create("Frame", {
		Size = UDim2.new(1, 0, 0, 10),
		Position = UDim2.new(0, 0, 1, -10),
		BackgroundColor3 = Color3.fromRGB(20, 20, 20),
		BorderSizePixel = 0,
		Parent = TopBar
	})
	
	local TopBarLine = Create("Frame", {
		Size = UDim2.new(1, 0, 0, 1),
		Position = UDim2.new(0, 0, 1, -1),
		BackgroundColor3 = Color3.fromRGB(60, 60, 60),
		BorderSizePixel = 0,
		Parent = TopBar
	})
	
	local TitleLabel = Create("TextLabel", {
		Name = "Title",
		Size = UDim2.new(1, -20, 1, 0),
		Position = UDim2.new(0, 20, 0, 0),
		BackgroundTransparency = 1,
		Text = config.Name,
		TextColor3 = Color3.fromRGB(240, 240, 240),
		TextSize = 16,
		Font = Enum.Font.GothamBold,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = TopBar
	})
	
	-- Close Button
	local CloseBtn = Create("TextButton", {
		Name = "Close",
		Size = UDim2.new(0, 30, 0, 30),
		Position = UDim2.new(1, -40, 0, 7.5),
		BackgroundColor3 = Color3.fromRGB(30, 30, 30),
		Text = "X",
		TextColor3 = Color3.fromRGB(240, 240, 240),
		TextSize = 14,
		Font = Enum.Font.GothamBold,
		BorderSizePixel = 0,
		Parent = TopBar
	})
	AddCorner(CloseBtn, 6)
	
	CloseBtn.MouseButton1Click:Connect(function()
		MainFrame.Visible = false
	end)
	
	-- Make draggable
	MakeDraggable(MainFrame, TopBar)
	
	-- Tab Container (Left Side)
	local TabContainer = Create("Frame", {
		Name = "TabContainer",
		Size = UDim2.new(0, 150, 1, -45),
		Position = UDim2.new(0, 0, 0, 45),
		BackgroundColor3 = Color3.fromRGB(32, 32, 32),
		BorderSizePixel = 0,
		Parent = MainFrame
	})
	
	local TabCornerCover = Create("Frame", {
		Size = UDim2.new(0, 10, 1, 0),
		Position = UDim2.new(0, 0, 0, 0),
		BackgroundColor3 = Color3.fromRGB(32, 32, 32),
		BorderSizePixel = 0,
		Parent = TabContainer
	})
	
	local TabList = AddListLayout(TabContainer, 0)
	AddPadding(TabContainer, 8)
	
	local TabLine = Create("Frame", {
		Size = UDim2.new(0, 1, 1, 0),
		Position = UDim2.new(1, -1, 0, 0),
		BackgroundColor3 = Color3.fromRGB(60, 60, 60),
		BorderSizePixel = 0,
		Parent = TabContainer
	})
	
	-- Content Container (Right Side)
	local ContentContainer = Create("Frame", {
		Name = "ContentContainer",
		Size = UDim2.new(1, -150, 1, -45),
		Position = UDim2.new(0, 150, 0, 45),
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		Parent = MainFrame
	})
	
	-- Intro Animation
	if config.IntroEnabled then
		MainFrame.Visible = false
		task.wait(0.5)
		MainFrame.Visible = true
		MainFrame.Size = UDim2.new(0, 0, 0, 0)
		TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {
			Size = UDim2.new(0, 615, 0, 400)
		}):Play()
	end
	
	function Window:MakeTab(tabConfig)
		tabConfig = tabConfig or {}
		tabConfig.Name = tabConfig.Name or "Tab"
		
		local Tab = {
			Elements = {}
		}
		
		-- Tab Button
		local TabButton = Create("TextButton", {
			Name = tabConfig.Name,
			Size = UDim2.new(1, 0, 0, 35),
			BackgroundColor3 = Color3.fromRGB(32, 32, 32),
			Text = "",
			AutoButtonColor = false,
			BorderSizePixel = 0,
			Parent = TabContainer
		})
		
		local TabLabel = Create("TextLabel", {
			Size = UDim2.new(1, -10, 1, 0),
			Position = UDim2.new(0, 10, 0, 0),
			BackgroundTransparency = 1,
			Text = tabConfig.Name,
			TextColor3 = Color3.fromRGB(200, 200, 200),
			TextSize = 13,
			Font = Enum.Font.GothamSemibold,
			TextXAlignment = Enum.TextXAlignment.Left,
			Parent = TabButton
		})
		
		-- Tab Content
		local TabContent = Create("ScrollingFrame", {
			Name = tabConfig.Name .. "_Content",
			Size = UDim2.new(1, 0, 1, 0),
			BackgroundTransparency = 1,
			BorderSizePixel = 0,
			ScrollBarThickness = 4,
			ScrollBarImageColor3 = Color3.fromRGB(60, 60, 60),
			CanvasSize = UDim2.new(0, 0, 0, 0),
			Visible = false,
			Parent = ContentContainer
		})
		
		local ContentList = AddListLayout(TabContent, 8)
		AddPadding(TabContent, 15)
		
		ContentList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			TabContent.CanvasSize = UDim2.new(0, 0, 0, ContentList.AbsoluteContentSize.Y + 30)
		end)
		
		-- Tab Selection
		TabButton.MouseButton1Click:Connect(function()
			for _, tab in pairs(Window.Tabs) do
				tab.Button.BackgroundColor3 = Color3.fromRGB(32, 32, 32)
				tab.Label.TextColor3 = Color3.fromRGB(200, 200, 200)
				tab.Label.Font = Enum.Font.GothamSemibold
				tab.Content.Visible = false
			end
			
			TabButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
			TabLabel.TextColor3 = Color3.fromRGB(240, 240, 240)
			TabLabel.Font = Enum.Font.GothamBold
			TabContent.Visible = true
			Window.CurrentTab = Tab
		end)
		
		-- First tab is selected by default
		if #Window.Tabs == 0 then
			TabButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
			TabLabel.TextColor3 = Color3.fromRGB(240, 240, 240)
			TabLabel.Font = Enum.Font.GothamBold
			TabContent.Visible = true
			Window.CurrentTab = Tab
		end
		
		Tab.Button = TabButton
		Tab.Label = TabLabel
		Tab.Content = TabContent
		table.insert(Window.Tabs, Tab)
		
		-- Add Section
		function Tab:AddSection(sectionConfig)
			sectionConfig = sectionConfig or {}
			sectionConfig.Name = sectionConfig.Name or "Section"
			
			local Section = {}
			
			local SectionFrame = Create("Frame", {
				Name = "Section",
				Size = UDim2.new(1, 0, 0, 30),
				BackgroundTransparency = 1,
				Parent = TabContent
			})
			
			local SectionLabel = Create("TextLabel", {
				Size = UDim2.new(1, 0, 0, 20),
				BackgroundTransparency = 1,
				Text = sectionConfig.Name,
				TextColor3 = Color3.fromRGB(150, 150, 150),
				TextSize = 13,
				Font = Enum.Font.GothamSemibold,
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = SectionFrame
			})
			
			local SectionLine = Create("Frame", {
				Size = UDim2.new(1, 0, 0, 1),
				Position = UDim2.new(0, 0, 1, -5),
				BackgroundColor3 = Color3.fromRGB(60, 60, 60),
				BorderSizePixel = 0,
				Parent = SectionFrame
			})
			
			return Section
		end
		
		-- Add Button
		function Tab:AddButton(buttonConfig)
			buttonConfig = buttonConfig or {}
			buttonConfig.Name = buttonConfig.Name or "Button"
			buttonConfig.Callback = buttonConfig.Callback or function() end
			
			local Button = {}
			
			local ButtonFrame = Create("TextButton", {
				Name = "Button",
				Size = UDim2.new(1, 0, 0, 35),
				BackgroundColor3 = Color3.fromRGB(32, 32, 32),
				Text = "",
				AutoButtonColor = false,
				BorderSizePixel = 0,
				Parent = TabContent
			})
			AddCorner(ButtonFrame, 6)
			AddStroke(ButtonFrame, Color3.fromRGB(60, 60, 60), 1)
			
			local ButtonLabel = Create("TextLabel", {
				Size = UDim2.new(1, -20, 1, 0),
				Position = UDim2.new(0, 15, 0, 0),
				BackgroundTransparency = 1,
				Text = buttonConfig.Name,
				TextColor3 = Color3.fromRGB(240, 240, 240),
				TextSize = 14,
				Font = Enum.Font.GothamBold,
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = ButtonFrame
			})
			
			ButtonFrame.MouseEnter:Connect(function()
				TweenService:Create(ButtonFrame, TweenInfo.new(0.2), {
					BackgroundColor3 = Color3.fromRGB(38, 38, 38)
				}):Play()
			end)
			
			ButtonFrame.MouseLeave:Connect(function()
				TweenService:Create(ButtonFrame, TweenInfo.new(0.2), {
					BackgroundColor3 = Color3.fromRGB(32, 32, 32)
				}):Play()
			end)
			
			ButtonFrame.MouseButton1Click:Connect(function()
				TweenService:Create(ButtonFrame, TweenInfo.new(0.1), {
					BackgroundColor3 = Color3.fromRGB(45, 45, 45)
				}):Play()
				task.wait(0.1)
				TweenService:Create(ButtonFrame, TweenInfo.new(0.1), {
					BackgroundColor3 = Color3.fromRGB(38, 38, 38)
				}):Play()
				
				pcall(buttonConfig.Callback)
			end)
			
			return Button
		end
		
		-- Add Toggle
		function Tab:AddToggle(toggleConfig)
			toggleConfig = toggleConfig or {}
			toggleConfig.Name = toggleConfig.Name or "Toggle"
			toggleConfig.Default = toggleConfig.Default or false
			toggleConfig.Callback = toggleConfig.Callback or function() end
			
			local Toggle = {
				Value = toggleConfig.Default
			}
			
			local ToggleFrame = Create("Frame", {
				Name = "Toggle",
				Size = UDim2.new(1, 0, 0, 40),
				BackgroundColor3 = Color3.fromRGB(32, 32, 32),
				BorderSizePixel = 0,
				Parent = TabContent
			})
			AddCorner(ToggleFrame, 6)
			AddStroke(ToggleFrame, Color3.fromRGB(60, 60, 60), 1)
			
			local ToggleLabel = Create("TextLabel", {
				Size = UDim2.new(1, -60, 1, 0),
				Position = UDim2.new(0, 15, 0, 0),
				BackgroundTransparency = 1,
				Text = toggleConfig.Name,
				TextColor3 = Color3.fromRGB(240, 240, 240),
				TextSize = 14,
				Font = Enum.Font.GothamBold,
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = ToggleFrame
			})
			
			local ToggleButton = Create("TextButton", {
				Name = "ToggleBtn",
				Size = UDim2.new(0, 40, 0, 20),
				Position = UDim2.new(1, -50, 0.5, -10),
				BackgroundColor3 = Toggle.Value and Color3.fromRGB(0, 180, 255) or Color3.fromRGB(60, 60, 60),
				Text = "",
				AutoButtonColor = false,
				BorderSizePixel = 0,
				Parent = ToggleFrame
			})
			AddCorner(ToggleButton, 10)
			
			local ToggleCircle = Create("Frame", {
				Name = "Circle",
				Size = UDim2.new(0, 16, 0, 16),
				Position = Toggle.Value and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8),
				BackgroundColor3 = Color3.fromRGB(255, 255, 255),
				BorderSizePixel = 0,
				Parent = ToggleButton
			})
			AddCorner(ToggleCircle, 8)
			
			local ToggleClick = Create("TextButton", {
				Size = UDim2.new(1, 0, 1, 0),
				BackgroundTransparency = 1,
				Text = "",
				Parent = ToggleFrame
			})
			
			function Toggle:Set(value)
				Toggle.Value = value
				
				TweenService:Create(ToggleButton, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {
					BackgroundColor3 = Toggle.Value and Color3.fromRGB(0, 180, 255) or Color3.fromRGB(60, 60, 60)
				}):Play()
				
				TweenService:Create(ToggleCircle, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {
					Position = Toggle.Value and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
				}):Play()
				
				pcall(toggleConfig.Callback, Toggle.Value)
			end
			
			ToggleClick.MouseButton1Click:Connect(function()
				Toggle:Set(not Toggle.Value)
			end)
			
			Toggle:Set(Toggle.Value)
			
			return Toggle
		end
		
		-- Add Label
		function Tab:AddLabel(text)
			local Label = {}
			
			local LabelFrame = Create("Frame", {
				Name = "Label",
				Size = UDim2.new(1, 0, 0, 30),
				BackgroundColor3 = Color3.fromRGB(32, 32, 32),
				BackgroundTransparency = 0.5,
				BorderSizePixel = 0,
				Parent = TabContent
			})
			AddCorner(LabelFrame, 6)
			AddStroke(LabelFrame, Color3.fromRGB(60, 60, 60), 1)
			
			local LabelText = Create("TextLabel", {
				Size = UDim2.new(1, -20, 1, 0),
				Position = UDim2.new(0, 15, 0, 0),
				BackgroundTransparency = 1,
				Text = text or "Label",
				TextColor3 = Color3.fromRGB(240, 240, 240),
				TextSize = 14,
				Font = Enum.Font.GothamBold,
				TextXAlignment = Enum.TextXAlignment.Left,
				Parent = LabelFrame
			})
			
			function Label:Set(newText)
				LabelText.Text = newText
			end
			
			return Label
		end
		
		return Tab
	end
	
	return Window
end

function Library:Destroy()
	if AnchorPart then
		AnchorPart:Destroy()
	end
end

return Library

